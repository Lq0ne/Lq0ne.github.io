{"title":"渗透测试笔记 - day35 SSRF","date":"2023-03-16T17:42:18.134Z","date_formatted":{"ll":"Mar 16, 2023","L":"03/16/2023","MM-DD":"03-16"},"link":"2023/03/16/渗透测试笔记 - day35 SSRF","updated":"2023-03-17T04:59:50.847Z","content":"<h2 id=\"ssrf漏洞原理\">SSRF漏洞原理<a title=\"#ssrf漏洞原理\" href=\"#ssrf漏洞原理\"></a></h2>\n<p>当目标主机具有被其他服务器访问权限时，攻击者可以通过控制其他服务器来伪造请求访问目标主机。</p>\n<p><strong>函数利用：</strong></p>\n<p>file_get_contents()</p>\n<p>fsockopen()</p>\n<p>curl()</p>\n<h2 id=\"ssrf利用方式\">SSRF利用方式<a title=\"#ssrf利用方式\" href=\"#ssrf利用方式\"></a></h2>\n<h3 id=\"pikachu-labs\tssrf-curl\"><strong>Pikachu-labs\tSSRF-curl</strong><a title=\"#pikachu-labs\tssrf-curl\" href=\"#pikachu-labs\tssrf-curl\"></a></h3>\n<ul>\n<li>http协议</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112148384.png\" alt=\"image-20220317211402585\" loading=\"lazy\" class=\"φbp\"></p>\n<ul>\n<li>file协议</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112148616.png\" alt=\"image-20220317211452862\" loading=\"lazy\" class=\"φbp\"></p>\n<ul>\n<li>ftp协议</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112148114.png\" alt=\"image-20220317212445091\" loading=\"lazy\" class=\"φbp\"></p>\n<ul>\n<li>dict协议</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112148992.png\" alt=\"image-20220317213016884\" loading=\"lazy\" class=\"φbp\"></p>\n<ul>\n<li>gopher协议</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112149980.png\" alt=\"image-20220318185907669\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112149624.png\" alt=\"image-20220318185955220\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112149288.png\" alt=\"image-20220318190001928\" loading=\"lazy\" class=\"φbp\"></p>\n<ul>\n<li>gopher+Redis</li>\n</ul>\n<p>利用SSRF攻击内网中未授权访问的Redis服务获取shell控制。</p>\n<h3 id=\"pikachu-labs\tssrf-file_conternt\"><strong>Pikachu-labs\tSSRF-file_conternt</strong><a title=\"#pikachu-labs\tssrf-file_conternt\" href=\"#pikachu-labs\tssrf-file_conternt\"></a></h3>\n<ul>\n<li>http协议</li>\n</ul>\n<p>只能访问http协议，无法进行端口探测</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112149093.png\" alt=\"image-20220318193521114\" loading=\"lazy\" class=\"φbp\"></p>\n<ul>\n<li>file协议</li>\n</ul>\n<p>只能访问文件，无法访问目录。<br>\n<img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112149435.png\" alt=\"image-20220318193709047\" loading=\"lazy\"></p>\n<ul>\n<li>php伪协议</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112149579.png\" alt=\"image-20220318193351125\" loading=\"lazy\" class=\"φbp\"></p>\n<h2 id=\"绕过\">绕过<a title=\"#绕过\" href=\"#绕过\"></a></h2>\n<p><strong>@绕过</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112149199.png\" alt=\"image-20220318194344958\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112149116.png\" alt=\"image-20220318194400619\" loading=\"lazy\" class=\"φbp\"></p>\n<p><strong>进制转换绕过</strong></p>\n<p>linux环境下，将ip转换为16或8进制绕过。</p>\n<h2 id=\"ssrf常见出现位置\">SSRF常见出现位置<a title=\"#ssrf常见出现位置\" href=\"#ssrf常见出现位置\"></a></h2>\n<ul>\n<li>早期应用中，为了更好的用户体验，web应用在分享功能中，通常会获取目标URL地址的网页内容。</li>\n<li>转码服务：通过URL地址把源地址的网页内容调优使其适合手机屏幕浏览。由于手机屏幕大小的关系，直接浏览网页内容的时候会造成许多不便，因此有些公司提供了转码功能，把网页内容发通过相关手段转为适合手机屏幕浏览的样式。例如百度、腾讯、搜狗等公司都有提供在线转码服务。</li>\n<li>图片加载与下载：通过URL地址加载或下载图片<br>\n图片加载远程图片地址此功能用到的地方很多，但大多都是比较隐秘，比如在有些公司中的加载字加图片服务器上的图片用于展示。（又是开发者为了更好的用户体验通常会对图片做些微笑调整如水印、压缩等而不使用img标签，所以就可能造成SSRF问题）</li>\n<li>百度翻译的SSRF漏洞</li>\n</ul>\n<h2 id=\"ssrf防御\">SSRF防御<a title=\"#ssrf防御\" href=\"#ssrf防御\"></a></h2>\n<ul>\n<li>限制HTTP端口，仅可使用http https</li>\n<li>检查IP是否内网IP，进行黑名单过滤</li>\n<li>禁止不需要的协议，gopher、file、ftp等</li>\n<li>统一错误信息，避免攻击者利用错误信息判断远程端口状态</li>\n</ul>\n","prev":{"title":"渗透测试笔记 - day37 逻辑漏洞","link":"2023/03/16/渗透测试笔记 - day37 逻辑漏洞"},"next":{"title":"渗透测试笔记 - day34 CSRF","link":"2023/03/16/渗透测试笔记 - day34 CSRF"},"plink":"https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day35 SSRF/","toc":[{"id":"ssrf漏洞原理","title":"SSRF漏洞原理","index":"1"},{"id":"ssrf利用方式","title":"SSRF利用方式","index":"2","children":[{"id":"pikachu-labs\tssrf-curl","title":"Pikachu-labs\tSSRF-curl","index":"2.1"},{"id":"pikachu-labs\tssrf-file_conternt","title":"Pikachu-labs\tSSRF-file_conternt","index":"2.2"}]},{"id":"绕过","title":"绕过","index":"3"},{"id":"ssrf常见出现位置","title":"SSRF常见出现位置","index":"4"},{"id":"ssrf防御","title":"SSRF防御","index":"5"}],"copyright":{"license":"个人原创 - 自由转载 - 保持署名 - 禁止商用","published":"March 16, 2023","author":"Lq0ne","link":"<a href=\"https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day35 SSRF/\" title=\"渗透测试笔记 - day35 SSRF\">https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day35 SSRF/</a>"},"reading_time":"662 words in 4 min"}