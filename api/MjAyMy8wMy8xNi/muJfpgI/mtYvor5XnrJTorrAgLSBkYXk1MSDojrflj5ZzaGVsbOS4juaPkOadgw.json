{"title":"渗透测试笔记 - day51 获取shell与提权","date":"2023-03-16T17:42:18.161Z","date_formatted":{"ll":"Mar 16, 2023","L":"03/16/2023","MM-DD":"03-16"},"link":"2023/03/16/渗透测试笔记 - day51 获取shell与提权","updated":"2023-03-17T05:01:21.685Z","content":"<h2 id=\"udf提权\">UDF提权<a title=\"#udf提权\" href=\"#udf提权\"></a></h2>\n<ul>\n<li>UDF（User Defined Function）：用户自定义函数</li>\n<li>利用前提：mysql5.0以上的需要在mysql安装目录的lib目录下新建一个plugin文件，5.0以下的。上传目录为C:/windows</li>\n<li>环境：windows10（mysql）、kali2021（sqlmap）</li>\n</ul>\n<h3 id=\"漏洞复现\">漏洞复现<a title=\"#漏洞复现\" href=\"#漏洞复现\"></a></h3>\n<p>查看mysql位数：</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204120936647.png\" alt=\"image-20220412093624600\" loading=\"lazy\" class=\"φbp\"></p>\n<p>进入sqlmap的目录下的\\data\\udf\\mysql\\windows\\64\\文件夹下。</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204120937955.png\" alt=\"image-20220412093716929\" loading=\"lazy\" class=\"φbp\"></p>\n<p>这里由于dll_文件直接使用会被误杀，所以dll文件经过了异或编码，不能直接使用。需要进行解码后使用。</p>\n<p>进入到sqlmap目录下的\\extra\\cloak\\文件夹下</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204120940637.png\" alt=\"image-20220412094019607\" loading=\"lazy\" class=\"φbp\"></p>\n<p>执行解码</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204120942630.png\" alt=\"image-20220412094256600\" loading=\"lazy\" class=\"φbp\"></p>\n<p>将该dll文件上传至mysql安装目录下的/lib/pludin/</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204121246870.png\" alt=\"image-20220412124622811\" loading=\"lazy\" class=\"φbp\"></p>\n<p>导入函数</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204121246039.png\" alt=\"image-20220412124645011\" loading=\"lazy\" class=\"φbp\"></p>\n<p>直接调用该函数</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204121247592.png\" alt=\"image-20220412124755554\" loading=\"lazy\" class=\"φbp\"></p>\n<p>实验完成。</p>\n<h2 id=\"linux内核漏洞/提权（cve-2022-0847）\">Linux内核漏洞/提权（CVE-2022-0847）<a title=\"#linux内核漏洞/提权（cve-2022-0847）\" href=\"#linux内核漏洞/提权（cve-2022-0847）\"></a></h2>\n<ul>\n<li>影响版本：linux kernel ∈ [5.8, 5.16.11/5.15.25/5.10.102)</li>\n<li>环境：kali linux2021</li>\n</ul>\n<h3 id=\"漏洞复现-1\">漏洞复现<a title=\"#漏洞复现-1\" href=\"#漏洞复现-1\"></a></h3>\n<p>准备poc</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122248092.png\" alt=\"image-20220412224834061\" loading=\"lazy\" class=\"φbp\"></p>\n<p>新建测试用户，并将其加入sudoers中</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122250269.png\" alt=\"image-20220412225011233\" loading=\"lazy\" class=\"φbp\"></p>\n<p>查找具有SUID权限的文件</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122317108.png\" alt=\"image-20220412231703053\" loading=\"lazy\" class=\"φbp\"></p>\n<p>执行poc</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122318222.png\" alt=\"image-20220412231834158\" loading=\"lazy\" class=\"φbp\"></p>\n<p>完成。</p>\n<h2 id=\"redis未授权访问\">redis未授权访问<a title=\"#redis未授权访问\" href=\"#redis未授权访问\"></a></h2>\n<ul>\n<li>漏洞利用条件：redis绑定在6379端口，且没有防火墙策略，或避免其他主机远程连接redis。没有设置密码验证。</li>\n</ul>\n<h3 id=\"漏洞复现-2\">漏洞复现<a title=\"#漏洞复现-2\" href=\"#漏洞复现-2\"></a></h3>\n<p>修改redis配置文件（redis.conf），注释掉绑定ip，关闭保护模式</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204121928053.png\" alt=\"image-20220412192759978\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204121928101.png\" alt=\"image-20220412192846065\" loading=\"lazy\" class=\"φbp\"></p>\n<p>启动redis</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204121934482.png\" alt=\"image-20220412193458406\" loading=\"lazy\" class=\"φbp\"></p>\n<p>攻击机使用redis-clil工具远程连接靶机redis</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122354251.png\" alt=\"image-20220412235453210\" loading=\"lazy\" class=\"φbp\"></p>\n<p>写入后门到tmp文件下</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122355192.png\" alt=\"image-20220412235504147\" loading=\"lazy\" class=\"φbp\"></p>\n<p>完成。</p>\n","prev":{"title":"渗透测试笔记 - day49 框架漏洞（Apache Shiro）","link":"2023/03/16/渗透测试笔记 - day49 框架漏洞（Apache Shiro）"},"next":{"title":"渗透测试笔记 - day50 Web框架漏洞（FastJson、Log4j2）","link":"2023/03/16/渗透测试笔记 - day50 Web框架漏洞（FastJson、Log4j2）"},"plink":"https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day51 获取shell与提权/","toc":[{"id":"udf提权","title":"UDF提权","index":"1","children":[{"id":"漏洞复现","title":"漏洞复现","index":"1.1"}]},{"id":"linux内核漏洞/提权（cve-2022-0847）","title":"Linux内核漏洞&#x2F;提权（CVE-2022-0847）","index":"2","children":[{"id":"漏洞复现-1","title":"漏洞复现","index":"2.1"}]},{"id":"redis未授权访问","title":"redis未授权访问","index":"3","children":[{"id":"漏洞复现-2","title":"漏洞复现","index":"3.1"}]}],"copyright":{"license":"个人原创 - 自由转载 - 保持署名 - 禁止商用","published":"March 16, 2023","author":"Lq0ne","link":"<a href=\"https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day51 获取shell与提权/\" title=\"渗透测试笔记 - day51 获取shell与提权\">https://Lq0ne.github.io/2023/03/16/渗透测试笔记 - day51 获取shell与提权/</a>"},"reading_time":"523 words in 3 min"}