{"title":"渗透测试笔记 - day52 获取shell与提权","date":"2022-05-09T00:00:00.000Z","date_formatted":{"ll":"May 9, 2022","L":"05/09/2022","MM-DD":"05-09"},"link":"2022/05/09/渗透测试笔记 - day52 获取shell与提权","updated":"2023-03-17T12:07:41.503Z","content":"<h2 id=\"写公钥\">写公钥<a title=\"#写公钥\" href=\"#写公钥\"></a></h2>\n<p>生成公钥，密码为空</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204121850328.png\" alt=\"image-20220412185022267\" loading=\"lazy\" class=\"φbp\"></p>\n<p>将公钥导入到文本文档中</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204121942818.png\" alt=\"image-20220412194226769\" loading=\"lazy\" class=\"φbp\"></p>\n<p>打开redis服务，将公钥文件写入到redis</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122338124.png\" alt=\"image-20220412233822045\" loading=\"lazy\" class=\"φbp\"></p>\n<p>连接靶机redis服务，并使用 CONFIG GET dir 命令得到Redis备份的路径</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122339192.png\" alt=\"image-20220412233946150\" loading=\"lazy\" class=\"φbp\"></p>\n<p>设置Redis备份路径为ssh公钥存放目录config set dir /root/.ssh</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122341475.png\" alt=\"image-20220412234112406\" loading=\"lazy\" class=\"φbp\"></p>\n<p>设置上传公钥的备份文件名字为authorized_keys</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122341517.png\" alt=\"image-20220412234136480\" loading=\"lazy\" class=\"φbp\"></p>\n<p>保存并退出</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122342136.png\" alt=\"image-20220412234211068\" loading=\"lazy\" class=\"φbp\"></p>\n<p>利用私钥免密登录靶机</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122350681.png\" alt=\"image-20220412235045622\" loading=\"lazy\" class=\"φbp\"></p>\n<p>实验完成。</p>\n<h2 id=\"进程注入提权\">进程注入提权<a title=\"#进程注入提权\" href=\"#进程注入提权\"></a></h2>\n<ul>\n<li>注入进程提权相当于开了一个后门，并且隐蔽性极高，不会创建新的进程。</li>\n<li>环境：win server 2003（ip：192.168.45.156），客户机开放apache服务放置pinjector.exe以供靶机访问下载</li>\n</ul>\n<h3 id=\"漏洞复现\">漏洞复现<a title=\"#漏洞复现\" href=\"#漏洞复现\"></a></h3>\n<p>靶机安装pinjector.exe</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122028151.png\" alt=\"image-20220412202823920\" loading=\"lazy\" class=\"φbp\"></p>\n<p>命令行运行pinjector -l参数，列出可使用的程序</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122203566.png\" alt=\"image-20220412220309027\" loading=\"lazy\" class=\"φbp\"></p>\n<p>挑选一个进程，执行pinjector.exe -p [PID] cmd 2222</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122208335.png\" alt=\"image-20220412220852282\" loading=\"lazy\" class=\"φbp\"></p>\n<p>攻击机连接靶机ip和2222端口</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122209382.png\" alt=\"image-20220412220924327\" loading=\"lazy\" class=\"φbp\"></p>\n<p>实验完成。</p>\n<h2 id=\"永恒之蓝\">永恒之蓝<a title=\"#永恒之蓝\" href=\"#永恒之蓝\"></a></h2>\n<ul>\n<li>是一种利用windows系统的SMB协议来获取最高权限的漏洞，不法分子可以通过永恒之蓝漏洞制作勒索病毒“WannaCry”</li>\n<li>利用端口：445</li>\n<li>永恒之蓝利用条件：关闭防火墙，确保没有打补丁</li>\n<li>环境：kali2022（攻击机：192.168.45.93）、windows 7 professional（靶机：192.168.45.33）、metasploit</li>\n</ul>\n<h3 id=\"漏洞复现：\">漏洞复现：<a title=\"#漏洞复现：\" href=\"#漏洞复现：\"></a></h3>\n<p>这里使用metasploit利用漏洞</p>\n<p>启动msfconsole</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122033951.png\" alt=\"image-20220412203303776\" loading=\"lazy\" class=\"φbp\"></p>\n<p>搜索漏洞编号ms17_010</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122034649.png\" alt=\"image-20220412203406550\" loading=\"lazy\" class=\"φbp\"></p>\n<p>选择exploit/windows/smb/ms17_010_eternalblue</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122035023.png\" alt=\"image-20220412203530917\" loading=\"lazy\" class=\"φbp\"></p>\n<p>设置攻击机地址端口</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122222557.png\" alt=\"image-20220412222223400\" loading=\"lazy\" class=\"φbp\"></p>\n<p>设置靶机地址</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122223991.png\" alt=\"image-20220412222310959\" loading=\"lazy\" class=\"φbp\"></p>\n<p>设置模块</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122225808.png\" alt=\"image-20220412222541734\" loading=\"lazy\" class=\"φbp\"></p>\n<p>最后查看一眼配置信息</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122230055.png\" alt=\"image-20220412223003925\" loading=\"lazy\" class=\"φbp\"></p>\n<p>执行（run或exploit）</p>\n<p><img src=\"https://raw.githubusercontent.com/Lq0ne/my_pic/main/202204122231523.png\" alt=\"image-20220412223154326\" loading=\"lazy\" class=\"φbp\"></p>\n<p>完成。</p>\n","prev":{"title":"渗透测试笔记 - day53 CS的使用","link":"2022/05/16/渗透测试笔记 - day53 CS的使用"},"next":{"title":"渗透测试笔记 - day51 获取shell与提权","link":"2022/05/07/渗透测试笔记 - day51 获取shell与提权"},"plink":"https://Lq0ne.github.io/2022/05/09/渗透测试笔记 - day52 获取shell与提权/","toc":[{"id":"写公钥","title":"写公钥","index":"1"},{"id":"进程注入提权","title":"进程注入提权","index":"2","children":[{"id":"漏洞复现","title":"漏洞复现","index":"2.1"}]},{"id":"永恒之蓝","title":"永恒之蓝","index":"3","children":[{"id":"漏洞复现：","title":"漏洞复现：","index":"3.1"}]}],"copyright":{"license":"个人原创 - 自由转载 - 保持署名 - 禁止商用","published":"May 9, 2022","author":"Lq0ne","link":"<a href=\"https://Lq0ne.github.io/2022/05/09/渗透测试笔记 - day52 获取shell与提权/\" title=\"渗透测试笔记 - day52 获取shell与提权\">https://Lq0ne.github.io/2022/05/09/渗透测试笔记 - day52 获取shell与提权/</a>"},"reading_time":"613 words in 4 min"}